"""add_brk_gemeentes_states

Revision ID: dedccf2ebc5f
Revises: 0ce50938f539
Create Date: 2022-03-23 16:50:01.580038

"""
from alembic import op
import sqlalchemy as sa
import geoalchemy2


# revision identifiers, used by Alembic.
revision = 'dedccf2ebc5f'
down_revision = '0ce50938f539'
branch_labels = None
depends_on = None


def upgrade():
    # ### commands auto generated by Alembic - please adjust! ###
    op.add_column('brk_gemeentes', sa.Column('volgnummer', sa.Integer(), nullable=True))
    op.add_column('brk_gemeentes', sa.Column('registratiedatum', sa.DateTime(), nullable=True))

    op.drop_constraint('rel_bag_wps_brk_gme_ligt_in_gemeente_dfk', 'rel_bag_wps_brk_gme_ligt_in_gemeente',
                       type_='foreignkey')
    op.drop_constraint('rel_brk_kge_brk_gme_ligt_in_gemeente_dfk', 'rel_brk_kge_brk_gme_ligt_in_gemeente',
                       type_='foreignkey')
    op.drop_constraint('rel_brk_kot_brk_gme_aangeduid_door_gemeente_dfk', 'rel_brk_kot_brk_gme__angdd_dr__gemeente',
                       type_='foreignkey')
    op.drop_constraint('rel_gbd_sdl_brk_gme_ligt_in_gemeente_dfk', 'rel_gbd_sdl_brk_gme_ligt_in_gemeente',
                       type_='foreignkey')
    op.drop_constraint('brk_gemeentes__id_key', 'brk_gemeentes', type_='unique')

    op.create_unique_constraint('brk_gemeentes__id_volgnummer_key', 'brk_gemeentes', ['_id', 'volgnummer'])
    op.create_foreign_key('rel_bag_wps_brk_gme_ligt_in_gemeente_dfk', 'rel_bag_wps_brk_gme_ligt_in_gemeente', 'brk_gemeentes', ['dst_id', 'dst_volgnummer'], ['_id', 'volgnummer'])
    op.create_foreign_key('rel_brk_kge_brk_gme_ligt_in_gemeente_dfk', 'rel_brk_kge_brk_gme_ligt_in_gemeente', 'brk_gemeentes', ['dst_id', 'dst_volgnummer'], ['_id', 'volgnummer'])
    op.create_foreign_key('rel_brk_kot_brk_gme__angdd_dr__gemeente_dfk', 'rel_brk_kot_brk_gme__angdd_dr__gemeente', 'brk_gemeentes', ['dst_id', 'dst_volgnummer'], ['_id', 'volgnummer'])
    op.create_foreign_key('rel_gbd_sdl_brk_gme_ligt_in_gemeente_dfk', 'rel_gbd_sdl_brk_gme_ligt_in_gemeente', 'brk_gemeentes', ['dst_id', 'dst_volgnummer'], ['_id', 'volgnummer'])
    # ### end Alembic commands ###

    # Drop dependent (materialized) views, recreated after migration
    op.execute('DROP MATERIALIZED VIEW IF EXISTS mv_gbd_sdl_brk_gme_ligt_in_gemeente CASCADE')
    op.execute('DROP MATERIALIZED VIEW IF EXISTS mv_brk_kot_brk_gme__angdd_dr__gemeente CASCADE')
    op.execute('DROP MATERIALIZED VIEW IF EXISTS mv_brk_kge_brk_gme_ligt_in_gemeente CASCADE')
    op.execute('DROP MATERIALIZED VIEW IF EXISTS mv_bag_wps_brk_gme_ligt_in_gemeente CASCADE')


def downgrade():
    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_constraint('rel_gbd_sdl_brk_gme_ligt_in_gemeente_dfk', 'rel_gbd_sdl_brk_gme_ligt_in_gemeente', type_='foreignkey')
    op.create_foreign_key('rel_gbd_sdl_brk_gme_ligt_in_gemeente_dfk', 'rel_gbd_sdl_brk_gme_ligt_in_gemeente', 'brk_gemeentes', ['dst_id'], ['_id'])
    op.drop_constraint('rel_brk_kot_brk_gme__angdd_dr__gemeente_dfk', 'rel_brk_kot_brk_gme__angdd_dr__gemeente', type_='foreignkey')
    op.create_foreign_key('rel_brk_kot_brk_gme_aangeduid_door_gemeente_dfk', 'rel_brk_kot_brk_gme__angdd_dr__gemeente', 'brk_gemeentes', ['dst_id'], ['_id'])
    op.drop_constraint('rel_brk_kge_brk_gme_ligt_in_gemeente_dfk', 'rel_brk_kge_brk_gme_ligt_in_gemeente', type_='foreignkey')
    op.create_foreign_key('rel_brk_kge_brk_gme_ligt_in_gemeente_dfk', 'rel_brk_kge_brk_gme_ligt_in_gemeente', 'brk_gemeentes', ['dst_id'], ['_id'])
    op.drop_constraint('rel_bag_wps_brk_gme_ligt_in_gemeente_dfk', 'rel_bag_wps_brk_gme_ligt_in_gemeente', type_='foreignkey')
    op.create_foreign_key('rel_bag_wps_brk_gme_ligt_in_gemeente_dfk', 'rel_bag_wps_brk_gme_ligt_in_gemeente', 'brk_gemeentes', ['dst_id'], ['_id'])
    op.drop_constraint('brk_gemeentes__id_volgnummer_key', 'brk_gemeentes', type_='unique')
    op.create_unique_constraint('brk_gemeentes__id_key', 'brk_gemeentes', ['_id'])
    op.drop_column('brk_gemeentes', 'registratiedatum')
    op.drop_column('brk_gemeentes', 'volgnummer')
    # ### end Alembic commands ###
